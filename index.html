<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Info</title>
    <style>
        body {
            background-color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            padding-bottom: 40px; 
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            padding: 20px;
            max-width: 100vw;
        }
        .box {
            border: 3px solid #000;
            padding: 10px;
            background-color: white;
            width: 200px;
            text-align: center;
            border-radius: 10px;
        }
        .photo {
            width: 200px;
            height: 250px;
            object-fit: cover;
            border-radius: 10px;
            border: none;
        }
        .input-container {
            margin: 20px;
            gap: 15px; /* Adds space between the textbox and button */
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
         
        }
        input {
            padding: 10px;
            font-size: 16px;
            text-transform: uppercase;
          	border-radius: 16px;
            border-color: #FF8C00;
        }
        input:focus {
            outline: none;
            box-shadow: none;
        }
        .input-container input {
    padding: 10px 15px;
    font-size: 16px;
    border: 2px solid #ccc;
    border-radius: 8px;
    outline: none;
    transition: border-color 0.3s ease;
}

.input-container input:focus {
    border-color: orange;
    box-shadow: 0 0 5px rgba(255,165,0,0.4);
}

        .btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            text-transform: uppercase;
            margin-left: 10px; /* Increase the gap */
            margin-top: 10px;
        }
        .btn:hover {
            background: linear-gradient(135deg, #FF8C00, #FFA500);
        }
        .btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            justify-content: center;
            align-items: center;
            gap: 20px;
        
        }

        .loader div {
            width: 16px;
            height: 16px;
            background-color: orange;
            border-radius: 50%;
            animation: bounce 1.5s infinite ease-in-out;
        }
        .loader div:nth-child(1) { animation-delay: 0s; }
        .loader div:nth-child(2) { animation-delay: 0.2s; }
        .loader div:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); opacity: 0.3; }
            40% { transform: scale(1); opacity: 1; }
        }


        .pagination {
            margin-top: 20px;
          
        }
        .pagination button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border: 2px solid #ce6d3a;
            background: white;
            color: #ce6d3a;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .pagination button:hover {
            background: #ce6d3a;
            color: white;
      }
      * {
        user-select: none;
        }
        /* Mobile responsiveness */
@media (max-width: 600px) {
    .input-container {
        flex-direction: column;
        align-items: center;
    }

    .input-container input,
    .input-container .btn {
        width: 90%;
        max-width: 300px;
    }
}
 .box {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.box.animate {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 140, 0, 0.6);
    z-index: 1;
}

.box {
    border: 3px solid #000;
    ...
}
    </style>
</head>
<body>
    <img style="height: 120px; width: 100%; max-width: 850px;" src="https://erp.adityauniversity.in/getBannerLogo.json?customerErpAcesLinkId=1">
    <hr>
    <h3>STUDENT PHOTOS</h3>
    <p>Enter Roll Number or Prefix (e.g., 23MH1A12) to generate student photos.</p>
    <div class="input-container">
        <input type="text" id="rollNumberInput" placeholder="Enter Roll Number" onkeypress="handleKeyPress(event)">
        <button class="btn" onclick="generatePhotos()">Generate Photos</button>
    </div>
    <div class="loader" id="loader">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="container" id="photoContainer"></div>
    <div class="pagination" id="pagination"></div>

    <marquee style="position: fixed; bottom: 0; left: 0; width: 100%; background-color: orange; height: 35px; line-height: 35px; z-index: 1000;">
        <i>Thank you for visiting our page! We hope you find it useful and informative.</i>
    </marquee>
    

    <script>
        let validImages = [];
        let currentPage = 0;
        const imagesPerPage = 100;

        function checkImageExists(url) {
            return new Promise((resolve) => {
                let img = new Image();
                img.src = url;
                img.onload = () => resolve(url);
                img.onerror = () => resolve(null);
            });
        }

        async function generatePhotos() {
            var prefix = document.getElementById("rollNumberInput").value.trim().toUpperCase();
            var container = document.getElementById("photoContainer");
            var pagination = document.getElementById("pagination");

            container.innerHTML = "";
            pagination.innerHTML = "";

            if (prefix.length === 10) {
                let imageUrl = `https://info.aec.edu.in/acet/studentPhotos/${prefix}.jpg`;
                
                if (prefix.substring(2,4) === "A9") {
                    imageUrl = `https://info.aec.edu.in/AEC/studentPhotos/${prefix}.jpg`;
                }

                let exists = await checkImageExists(imageUrl);
                if (!exists) {
                    alert("Photo not found.");
                    return;
                }

                container.innerHTML = `<div class="box"><h4>${prefix}</h4><img class="photo" src="${imageUrl}" alt="Student Photo"></div>`;
                return;
            }

            if (prefix.length !== 8) {
                alert("Please enter a valid roll number prefix (e.g., 23MH1A12).");
                return;
            }
        
            loader.style.display = "flex";

            let rollNumbers = [];
            rollNumbers.push(...generateRollNumbers(prefix));
            var lePrefix = convertToLE(prefix);
            rollNumbers.push(...generateRollNumbers(lePrefix));

            let results = await Promise.allSettled(
                rollNumbers.map(roll => {
                    let url = `https://info.aec.edu.in/acet/studentPhotos/${roll}.jpg`;

                    if (prefix.substring(2,4) === "A9") {
                        url = `https://info.aec.edu.in/AEC/studentPhotos/${roll}.jpg`;
                    }

                    return checkImageExists(url).then(result => (result ? { roll, imageUrl: url } : null));
                })
            );

            validImages = results.filter(result => result.status === "fulfilled" && result.value !== null).map(result => result.value);

            loader.style.display = "none";
            
            if (validImages.length === 0) {
                container.innerHTML = "<p>No photos found.</p>";
                return;
            }

            currentPage = 0;
            displayPhotos();
        }

        function displayPhotos() {
    const container = document.getElementById("photoContainer");
    const pagination = document.getElementById("pagination");
    container.innerHTML = "";
    pagination.innerHTML = "";

    const start = currentPage * imagesPerPage;
    const end = start + imagesPerPage;
    const imagesToShow = validImages.slice(start, end);

    let fragment = document.createDocumentFragment();
    imagesToShow.forEach(({ roll, imageUrl }) => {
        const box = document.createElement("div");
        box.classList.add("box");
       box.innerHTML = `
  <h4>${roll}</h4>
  <img class="photo" src="${imageUrl}" alt="Student Photo">
  <div class="student-name" id="name-${roll}">Loading...</div>
`;

fetch("https://student-name-api.onrender.com/get_name", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: "roll_number=" + encodeURIComponent(roll)
})
.then(res => res.json())
.then(data => {
    document.getElementById(`name-${roll}`).innerText = data.name;
})
.catch(() => {
    document.getElementById(`name-${roll}`).innerText = "Name not found";
});
        fragment.appendChild(box);

        
        observer.observe(box); // <--- Observe each photo box
    });
    container.appendChild(fragment);

    const totalPages = Math.ceil(validImages.length / imagesPerPage);

    // Create Previous button
    if (currentPage > 0) {
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "Previous";
        prevBtn.onclick = () => {
            currentPage--;
            displayPhotos();
            window.scrollTo(0, 0);
        };
        pagination.appendChild(prevBtn);
    }

    // Create Next button
    if (currentPage < totalPages - 1) {
        const nextBtn = document.createElement("button");
        nextBtn.textContent = "Next";
        nextBtn.onclick = () => {
            currentPage++;
            displayPhotos();
            window.scrollTo(0, 0);
        };
        pagination.appendChild(nextBtn);
    }
}

// Set up Intersection Observer
const observerOptions = {
    root: null,
    rootMargin: "-40% 0px -40% 0px", // triggers only when near center vertically
    threshold: 0.1
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate');
        } else {
            entry.target.classList.remove('animate');
        }
    });
}, observerOptions);



        function generateRollNumbers(basePrefix) {
            let rollNumbers = [];
            for (let i = 1; i <= 99; i++) {
                let roll = basePrefix + (i < 10 ? "0" : "") + i;
                rollNumbers.push(roll);
            }
            for (let letter = 65; letter <= 90; letter++) {
                for (let number = 0; number <= 9; number++) {
                    let roll = basePrefix + String.fromCharCode(letter) + number;
                    rollNumbers.push(roll);
                }
            }
            return rollNumbers;
        }

        function convertToLE(prefix) {
            var year = parseInt(prefix.substring(0, 2)) + 1;
            var branchCode = prefix.startsWith("23MH") ? "P3" : prefix.substring(2, 4);
            return year.toString() + branchCode + "5" + prefix.substring(5);
        }

        
        function handleKeyPress(event) {
            if (event.key === "Enter") {
                generatePhotos();
            }
        }
    </script>
</body>
</html>
